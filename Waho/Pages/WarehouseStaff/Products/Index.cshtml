@page
@model Waho.Pages.WarehouseStaff.Products.IndexModel

@{
    ViewData["Title"] = "Index";
}


<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Waho - Sản Phẩm</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Waho.styles.css" asp-append-version="true" />

    <style>
        .message {
            text-align: right;
            color: red;
            font-size: 14px;
            margin: 2px 6px;
            animation-name: myAnimation;
            animation-duration: 10000ms;
            animation-fill-mode: forwards;
        }

        .input-box.button {
            color: #fff;
            letter-spacing: 1px;
            border: none;
            background: #FF6600;
            cursor: pointer;
        }

            .input-box.button:hover {
                background: #0e4bf1;
            }


        .modal {
            position: fixed;
            left: 0;
            top: 0;
            display: block;
            background: rgba(0, 0, 0, 0.5);
            height: 100%;
            width: 100%;
            transform: scale(0);
            transition-duration: 0s;
            z-index: 99;
            display: flex;
        }

        #insert-user-modal {
            margin: auto;
            width: 40%;
            padding: 15px 35px 15px 35px;
            background: #fff;
            transform: scale(0);
            transition-duration: 0.4s;
            z-index: 99;
            border-radius: 5px;
            box-shadow: 0px 0px 1px 1px #ccc;
        }

        #more-modal {
            margin: auto;
            width: 40%;
            padding: 15px 35px 15px 35px;
            background: #fff;
            transform: scale(0);
            transition-duration: 0.4s;
            z-index: 99;
            border-radius: 5px;
            box-shadow: 0px 0px 1px 1px #ccc;
        }

        #edit-user-modal {
            margin: auto;
            width: 60%;
            display: block;
            padding: 15px 35px 15px 35px;
            background: #fff;
            transform: scale(0);
            transition-duration: 0.4s;
            z-index: 99;
            border-radius: 5px;
            box-shadow: 0px 0px 1px 1px #ccc;
        }

        .active {
            z-index: 3;
        }
    </style>

</head>
<body style="background: #f2f2f2">
@*insert model*@
<div class="modal">
    <div id="insert-user-modal">
        <form id="searchForm" asp-page="./Create" method="post">
            <div class="col-md-6">
                <h4 class="text-right">Thêm người dùng mới</h4>
                <div id="notification"></div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <label class="labels">Tên tài khoản</label>
                    <input name="username" class="form-control input" type="text" placeholder="Nhập tên tài khoản" required>
                </div>
                <div class="col-md-6">
                    <label class="labels">Email</label>
                    <input name="email" class="form-control input" type="email" placeholder="Nhập email" required>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <label class="labels">Họ và tên</label>
                    <input name="name" type="text" class="form-control input" placeholder="Nhập họ và tên" required>
                </div>
                <div class="col-md-6">
                    <label class="labels">Ngày sinh</label>
                    <input name="dob" type="date" class="form-control input">
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <label class="labels">Số điện thoại</label>
                    <input name="phone" pattern="[0-9]{10}" type="text" class="form-control input" placeholder="Nhập số điện thoại" required>
                </div>
                <div class="col-md-6">
                    <label class="labels">Giới tính</label><br />
                    <input type="radio" name="gender" class="mt-3 input"> Nam
                    <input type="radio" name="gender" style="margin-left: 50px" class="mt-3 input"> Nữ
                </div>
            </div>
            <div class="row mt-2">
                <div>
                    <label class="labels">Địa chỉ</label>
                    <input name="address" type="text" class="form-control input" placeholder="Nhập địa chỉ">
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-6">
                    <label class="labels">Vai trò</label>
                    <select name="role" class="form-select input" aria-label="Default select example">
                        <c:forEach items="${requestScope.groups}" var="g">
                            <option value="${g.id}">${g.name}</option>
                        </c:forEach>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="labels">Trạng thái</label>
                    <select name="status" class="form-select input" aria-label="Default select example">
                        <option value="1">Kích hoạt</option>
                        <option value="0">Khoá</option>
                    </select>
                </div>
            </div>
            <div class="text-center mt-5">
                <!--                        <button class="input-box button" type="submit" style="padding: 5px;border-radius: 5px">Thêm người dùng</button>-->
                <button class="input-box button" type="button" style="padding: 5px;border-radius: 5px" onclick="insertUser()">Thêm người dùng</button>
                <button style="margin-left: 10px;padding:5px;border-radius: 5px" class="input-box button btn btn-primary profile-button" type="button" onclick="modal('insert-user-modal', 0, 'scale(0)')">Đóng</button>
            </div>
        </form>
    </div>
</div>
@*end insert model*@
@*More model*@
<div class="modal">
    <div class="row" id="more-modal">
        <div class="col-lg-4">
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Tên sản phẩm" id="productName" onclick="showProperty('tbProductName')" class="col-lg-6 btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Tên sản phẩm</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Giá nhập" id="importPrice" onclick="showProperty('tbImportPrice')" class="col-lg-6 btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Giá nhập</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Đơn giá" id="unitPrice" onclick="showProperty('tbUnitPrice')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Đơn giá</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Giá tại kho" id="unitInStock" onclick="showProperty('tbUnitInStock')" class="col-lg-6 btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Giá tại kho</i>
            </div>
                
        </div>

        <div class="col-lg-4">
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Thương hiệu" id="trademark" onclick="showProperty('tbTrademark')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Thương hiệu</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Trọng lượng" id="weight" onclick="showProperty('tbWeight')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Trọng lượng</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Vị trí" id="location" onclick="showProperty('tbLocation')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Vị trí</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Đơn vị" id="unit" onclick="showProperty('tbUnit')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Đơn vị</i>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Định Mức tồn Min" id="inventoryLevelMin" onclick="showProperty('tbInventoryLevelMin')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Đơn vị</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Định Mức tồn Max" id="inventoryLevelMax" onclick="showProperty('tbInventoryLevelMax')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Đơn vị</i>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <input type="checkbox" value="Mô tả" id="description" onclick="showProperty('tbDescription')" class="btn btn-primary w-75 m-2" />
                </div>
                <i class="col-lg-6">Đơn vị</i>
            </div>
        </div>
        <div class="text-center mt-5">
            <button style="margin-left: 10px;padding:5px;border-radius: 5px" class="input-box button btn btn-primary profile-button" type="button" onclick="modal('more-modal', 1, 'scale(0)')">Đóng</button>
        </div>
    </div>
    </div>
@*end more model*@
@*start filter*@
<div style=" padding:10px;margin-top: 20px; border-radius: 10px;" class="col-lg-12">
    <form method="get" asp-page="./Index" style="margin-bottom: 20px; ">
        <div class="row">
            <div class="form-group col-md-1">
                <label for="inputState">Hiển thị</label>
                    <select id="inputState" class="form-control" asp-for="pageSize" onchange="this.form.submit()">
                    <option value="5"> 5 hàng</option>
                    <option value="10">10 hàng</option>
                    <option value="15">15 hàng</option>
                    <option value="20">20 hàng</option>
                </select>
            </div>
            <div class="form-group col-md-3">
                <input type="text" asp-for="textSearch" class="form-control" placeholder="Nhập tên sản phẩm, loại sản phẩm, tên nhà cung cấp" style="margin-top: 20px">
            </div>
            <div class="form-group col-md-2" style="">
                <button class="input-box button" type="submit" style="border-radius: 5px;padding: 5px 15px 5px 15px; margin-top: 20px">
                    <i style="" class="bi bi-search fa-lg"> Tìm kiếm</i>
                </button>
            </div>
            <div class="form-group col-md-2">
                <button style="padding: 5px 15px 5px 15px;border-radius: 5px;text-align: center; margin-top: 20px" class="input-box button" type="button" onclick="modal('insert-user-modal', 0, 'scale(1)');">
                    <i class="bi bi-person-plus-fill" asp-page="Create"> Thêm sản phẩm</i>
                </button>
            </div>
            <div class="form-group col-md-2">
                <button style="padding: 5px 15px 5px 15px;border-radius: 5px;text-align: center; margin-top: 20px" class="input-box button" type="button" onclick="modal('more-modal', 1, 'scale(1)');">
                    <i class="bi bi-person-plus-fill" asp-page="Create"> Xem Thêm </i>
                </button>
            </div>
        </div>
    </form>
    @*end filter*@
    <div class="row ">
            <div class="col-lg-2" style="background-color: #fff; border-radius: 10px; padding:10px;margin-right: 10px">
            <div class="row">
                <form method="get" asp-page="./Index">
                <div class="text-center">Loại sản phẩm</div>
                    <ul class="w-75 rounded-2 list-inline" style="padding-left:30px; padding-top:20px; font-size: small">
                        @foreach (var item in Model.subCategories)
                        {
                                <li class="m-1 pointer-event " onclick="this.form.submit()"> <a class="text-decoration-none" style="color: black" asp-route-subCategory="@(item.SubCategoryId)">@(item.SubCategoryName)</a></li>
                        }
                    </ul>
                </form>
            </div>
        </div>  
            <div class="col-lg-9 table-responsive" style="overflow-x: auto; background-color: #fff; border-radius: 10px; padding:10px;margin-left:10px">
                <table class="table table-striped table-hover">
                <thead>
                    <tr>
                            <th id="tbProductName" scope="col">
                            Tên sản phẩm
                        </th>
                            <th id="tbImportPrice" scope="col">
                            Giá nhập
                        </th>
                            <th id="tbUnitPrice" scope="col">
                            Đơn giá
                        </th>
                        <th style="display:none" id="tbUnitInStock">
                            Giá tại cửa hàng
                        </th>
                        <th style="display:none">
                            @Html.DisplayNameFor(model => model.Product[0].HaveDate)
                        </th>
                        <th style="display:none">
                            @Html.DisplayNameFor(model => model.Product[0].DateOfManufacture)
                        </th>
                        <th style="display:none">
                            @Html.DisplayNameFor(model => model.Product[0].Expiry)
                        </th>
                        <th style="display:none" id="tbTrademark">
                            Thương hiệu
                        </th>
                        <th style="display:none" id="tbWeight">
                            Trọng lượng
                        </th>
                        <th id="tbLocation">
                            Vị trí
                        </th>
                        <th style="display:none" id="tbUnit">
                            Đơn vị
                        </th>
                        <th style="display:none" id="tbInventoryLevelMin">
                            Định mức tồn min
                        </th>
                        <th style="display:none" id="tbInventoryLevelMax">
                            Định mức tồn max
                        </th>
                        <th style="display:none" id="tbDescription">
                            Miêu tả
                        </th>
                        <th id="tbSubCategory">
                            Loại sản phẩm
                        </th>
                        <th style="display:none">
                            @Html.DisplayNameFor(model => model.Product[0].Supplier)
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Product)
                    {
                        <tr>
                            <td id="tbProductName">
                                @Html.DisplayFor(modelItem => item.ProductName)
                            </td>
                            <td id="tbImportPrice">
                                @Html.DisplayFor(modelItem => item.ImportPrice)
                            </td>
                            <td id="tbUnitPrice">
                                @Html.DisplayFor(modelItem => item.UnitPrice)
                            </td>
                            <td style="display:none" id="tbUnitInStock">
                                @Html.DisplayFor(modelItem => item.UnitInStock)
                            </td>
                            <td style="display:none">
                                @Html.DisplayFor(modelItem => item.HaveDate)
                            </td>
                            <td style="display:none">
                                @Html.DisplayFor(modelItem => item.DateOfManufacture)
                            </td>
                            <td style="display:none">
                                @Html.DisplayFor(modelItem => item.Expiry)
                            </td>
                            <td style="display:none" id="tbTrademark">
                                @Html.DisplayFor(modelItem => item.Trademark)
                            </td>
                            <td style="display:none" id="tbWeight">
                                @Html.DisplayFor(modelItem => item.Weight)
                            </td>
                            <td id="tbLocation">
                                @Html.DisplayFor(modelItem => item.Location)
                            </td>
                            <td style="display:none" id="tbUnit">
                                @Html.DisplayFor(modelItem => item.Unit)
                            </td>
                            <td style="display:none" id="tbInventoryLevelMin">
                                @Html.DisplayFor(modelItem => item.InventoryLevelMin)
                            </td>
                            <td style="display:none" id="tbInventoryLevelMax">
                                @Html.DisplayFor(modelItem => item.InventoryLevelMax)
                            </td>
                            <td style="display:none" id="tbDescription">
                                @Html.DisplayFor(modelItem => item.Description)
                            </td>
                            <td id="tbSubCategory">
                                @Html.DisplayFor(modelItem => item.SubCategory.SubCategoryName)
                            </td>
                            <td class="d-none">
                                @Html.DisplayFor(modelItem => item.Supplier.SupplierId)
                            </td>
                            <td>
                                <a class="bi bi-123" asp-page="./Edit" asp-route-id="@item.ProductId">Sửa</a> |
                                <a asp-page="./Details" asp-route-id="@item.ProductId">Chi tiết</a> |
                                <a class="bi bi-6-square-fill" asp-page="./Delete" asp-route-id="@item.ProductId">xóa</a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="text-center mt-5">
                <div class="pagination">
                    <ul class="pagination">
                        @if (Model.pageIndex > 1)
                        {
                            <li class="page-item"><a class="page-link" asp-page="./Index" asp-route-pageIndex="@(Model.pageIndex - 1)">Trước</a></li>
                        }
                            @for (int i = 1; i <= Math.Ceiling(Model.TotalCount / (double)Model.pageSize); i++)
                        {
                            <li class="page-item @(Model.pageIndex == i ? "active" : "")"><a class="page-link" asp-page="./Index" asp-route-pageIndex="@i">@i</a></li>
                        }
                            @if (Model.pageIndex < Math.Ceiling(Model.TotalCount / (double)Model.pageSize))
                        {
                            <li class="page-item"><a class="page-link" asp-page="./Index" asp-route-pageIndex="@(Model.pageIndex + 1)">Sau</a></li>
                        }
                    </ul>
                </div>
                </div>
        </div>
    </div>
</div>
<script>
    function modal(id, position, transform) {
                var box = document.getElementById(id);
                var modal = document.getElementsByClassName('modal');
                modal[position].style.transform = transform;
                box.style.transform = transform;
            }
    function ShowButton(){
        if (document.getElementById("showButton").style.display === "none"){
            document.getElementById("showButton").style.display = "block";
        }else{
            document.getElementById("showButton").style.display = "none";
        }
    }

    function showProperty(id){
        if (document.getElementById(id).style.display === "none") {
            document.getElementById(id).style.display = "block";
        } else {
            document.getElementById(id).style.display = "none";
        }
    }

    //sort table
    $(document).ready(function(){
    $("th").click(function(){
      var table = $(this).parents('table').eq(0)
      var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
      this.asc = !this.asc
      if (!this.asc){rows = rows.reverse()}
      for (var i = 0; i < rows.length; i++){table.append(rows[i])}
    })
    function comparer(index) {
      return function(a, b) {
        var valA = getCellValue(a, index), valB = getCellValue(b, index)
        return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.localeCompare(valB)
      }
    }
    function getCellValue(row, index){ return $(row).children('td').eq(index).text() }
  })
</script>
<script src="../../../admin/js/tabler.min.js" defer></script>
<script src="../../../admin/js/demo.min.js" defer></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.12.0/js/dataTables.bootstrap4.min.js"></script>
</body>
